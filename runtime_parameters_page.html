<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KTH framework for Nek5000 toolboxes; testing version: Runtime parameters for KTH framework.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KTH framework for Nek5000 toolboxes; testing version
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('runtime_parameters_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Runtime parameters for KTH framework. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="rparam_file"></a>
Runtime parameter file.</h1>
<p>An important issue for our framework is organised structure of runtime parameters that would allow for simple modiffication of parameter list without introducing conflicts between different code parts. As old <em>###</em>.rea file does not provide sufficent flexibility, all tool developers are obligated to use new <em>###</em>.par file instead, as it organises runtime parameters by sections and in addition to 20 user parameters in <em></em>[GENERAl] section allows to introduce user defined sections. Every section starting with underscore is treated as user section and its consistency is not checked by Nek5000 core code. Following examples shows two native Nek5000 sections and three user sections: </p><div class="fragment"><div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># nek parameter file</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line">[GENERAL] </div>
<div class="line"><span class="preprocessor">#startFrom = rst_lid.1</span></div>
<div class="line">stopAt = numSteps #endTime</div>
<div class="line"><span class="preprocessor">#endTime = 1.0</span></div>
<div class="line">numSteps = 100</div>
<div class="line"> </div>
<div class="line">dt = -1.0e-03</div>
<div class="line">timeStepper = bdf3 #<span class="keywordtype">char</span> #steady</div>
<div class="line">variableDt = no</div>
<div class="line">targetCFL = 0.3</div>
<div class="line"> </div>
<div class="line">writeControl = timeStep #runTime</div>
<div class="line">writeInterval = 50  </div>
<div class="line"> </div>
<div class="line">dealiasing = yes</div>
<div class="line">filtering = hpfrt</div>
<div class="line">filterWeight = 10.0</div>
<div class="line">filterCutoffRatio = 0.84</div>
<div class="line"> </div>
<div class="line">userParam01 =-3     # param(54) fixed flow rate dir.</div>
<div class="line">userParam02 = 1     <span class="preprocessor"># param(55) vol. flow rate</span></div>
<div class="line"> </div>
<div class="line">[PROBLEMTYPE]</div>
<div class="line">stressFormulation = no</div>
<div class="line"><span class="preprocessor">#dp0dt = yes</span></div>
<div class="line">variableProperties = no</div>
<div class="line"> </div>
<div class="line">[PRESSURE]</div>
<div class="line"><span class="preprocessor">#preconditioner = # Schwarz is default for Nekp4est - this line should be commented0</span></div>
<div class="line">residualTol = 1e-8</div>
<div class="line">residualProj = yes</div>
<div class="line"> </div>
<div class="line">[VELOCITY]</div>
<div class="line">residualTol = 1e-8</div>
<div class="line">residualProj = yes</div>
<div class="line">density = 1.0</div>
<div class="line">viscosity = -2.5E+03</div>
<div class="line">advection = yes</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line">[_RUNPAR]               # Runtime parameter section <span class="keywordflow">for</span> rprm module</div>
<div class="line">PARFWRITE            = no                     # Do we write runtime parameter <a class="code" href="structfile.html">file</a></div>
<div class="line">PARFNAME             = outparfile             # Runtime parameter <a class="code" href="structfile.html">file</a> name <span class="keywordflow">for</span> output (without .par)</div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line">[_MONITOR]              # Runtime parameter section <span class="keywordflow">for</span> monitor module</div>
<div class="line">LOGLEVEL             = 4                      # Logging threshold <span class="keywordflow">for</span> toolboxes</div>
<div class="line">WALLTIME             = 23:45                  # Simulation wall time</div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line">[_STAT]             # Runtime paramere section <span class="keywordflow">for</span> statistics module</div>
<div class="line">AVSTEP               = 10</div>
<div class="line">IOSTEP               = 50</div>
<div class="ttc" id="astructfile_html"><div class="ttname"><a href="structfile.html">file</a></div><div class="ttdef"><b>Definition:</b> <a href="crs__amg__io_8h_source.html#l00037">crs_amg_io.h:37</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="rparam_module"></a>
Module's runtime parameters.</h1>
<p>We utilize user defined sections in <em>###</em>.par to set values of runtime parametes defined in different modules. To simplify interaction between different tools the <a class="el" href="group__frame.html">frame</a> module provides dynamical database of all available runtime parameters in the framework. To provide requred information to the framework we introduce the module registration phase and split if from the module intialistation. All these steps are performed by <a class="el" href="group__frame.html#ga3b2fa5ca96c4d901949ed15b9e1e459c">frame_start</a>, which initialises the framework itself and next calls a user interface <em>frame_usr_register</em>. This routine shoud be placed in <em>###</em>.usr and contain calls to the module registration routines. The registration of the module consists of signing up the module in the database followed by the runtime parameters definitions (name, type, description and default value) and finalised with timers definitions. This information is used to check consistency of the <em>###</em>.par file and to fill in runtime parameter database. Next user defined <em>frame_usr_init</em> is called by <a class="el" href="group__frame.html#ga3b2fa5ca96c4d901949ed15b9e1e459c">frame_start</a>. It initilises all the modules by calling their initialisation routines. This operation consists of taking back updated values of runtime parameters from the database and performing requred by the module addtional operations.</p>
<p>Following example shows the way a statistics module is initialised: </p><div class="fragment"><div class="line"><span class="comment">!======================================================================</span></div>
<div class="line">      <span class="keyword">subroutine </span>userchk</div>
<div class="line">      <span class="keywordtype">implicit none</span></div>
<div class="line">      include <span class="stringliteral">&#39;SIZE&#39;</span>            <span class="comment">!</span></div>
<div class="line">      include <span class="stringliteral">&#39;TSTEP&#39;</span>           <span class="comment">! ISTEP, lastep, time</span></div>
<div class="line">      include <span class="stringliteral">&#39;INPUT&#39;</span>           <span class="comment">! IF3D, PARAM</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (istep.eq.0) <span class="keywordflow">then</span></div>
<div class="line"><span class="comment">!     start framework</span></div>
<div class="line">         <span class="keyword">call </span><a class="code" href="group__frame.html#ga3b2fa5ca96c4d901949ed15b9e1e459c">frame_start</a></div>
<div class="line"> </div>
<div class="line"><span class="comment">!     set volume flow parameters</span></div>
<div class="line">         param(54) = uparam(1)</div>
<div class="line">         param(55) = uparam(2)</div>
<div class="line"><span class="keywordflow">      endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">!     monitor simulation</span></div>
<div class="line">      <span class="keyword">call </span><a class="code" href="group__frame.html#ga3100879c73f67d2e4449da55049c8eae">frame_monitor</a></div>
<div class="line"> </div>
<div class="line"><span class="comment">!     for statistics</span></div>
<div class="line">      <span class="keyword">call </span><a class="code" href="group__stat.html#ga16cd0d213c2bea15c7caf8c205241388">stat_avg</a></div>
<div class="line"> </div>
<div class="line"><span class="comment">!     finalise framework</span></div>
<div class="line">      <span class="keywordflow">if</span> (istep.eq.nsteps.or.lastep.eq.1) <span class="keywordflow">then</span></div>
<div class="line">         <span class="keyword">call </span><a class="code" href="group__frame.html#ga81cd9de9df55590aae9e54090dd1a3ce">frame_end</a></div>
<div class="line"><span class="keywordflow">      endif</span></div>
<div class="line">     </div>
<div class="line">      <span class="keywordflow">return</span></div>
<div class="line">      <span class="keyword">end</span></div>
<div class="line"><span class="comment">!======================================================================</span></div>
<div class="line">      <span class="keyword">subroutine </span>frame_usr_register</div>
<div class="line">      <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">      include <span class="stringliteral">&#39;SIZE&#39;</span></div>
<div class="line">      include <span class="stringliteral">&#39;FRAMELP&#39;</span></div>
<div class="line"><span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line">      <span class="keyword">call </span><a class="code" href="group__stat.html#ga5b0d78dee858f1d9efcd6ce57aeb5ec8">stat_register</a></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span></div>
<div class="line">      <span class="keyword">end subroutine</span></div>
<div class="line"><span class="comment">!======================================================================</span></div>
<div class="line">      <span class="keyword">subroutine </span>frame_usr_init</div>
<div class="line">      <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">      include <span class="stringliteral">&#39;SIZE&#39;</span></div>
<div class="line">      include <span class="stringliteral">&#39;FRAMELP&#39;</span></div>
<div class="line"><span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line">      <span class="keyword">call </span><a class="code" href="group__stat.html#ga451d6573c47246d8e0c35e4028a3a1f0">stat_init</a></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">return</span></div>
<div class="line">      <span class="keyword">end subroutine</span></div>
<div class="line"><span class="comment">!======================================================================</span></div>
<div class="line">      <span class="keyword">subroutine </span>frame_usr_end</div>
<div class="line">      <span class="keywordtype">implicit none</span></div>
<div class="line"> </div>
<div class="line">      include <span class="stringliteral">&#39;SIZE&#39;</span></div>
<div class="line">      include <span class="stringliteral">&#39;FRAMELP&#39;</span></div>
<div class="line"><span class="comment">!-----------------------------------------------------------------------</span></div>
<div class="line">      <span class="keyword">call </span><a class="code" href="group__stat.html#gaac93fa6c1a2e5a04333c0023f52b95f8">stat_end</a></div>
<div class="line">      </div>
<div class="line">      <span class="keywordflow">return</span></div>
<div class="line">      <span class="keyword">end subroutine</span></div>
<div class="line">!======================================================================</div>
<div class="ttc" id="agroup__frame_html_ga3100879c73f67d2e4449da55049c8eae"><div class="ttname"><a href="group__frame.html#ga3100879c73f67d2e4449da55049c8eae">frame_monitor</a></div><div class="ttdeci">subroutine frame_monitor</div><div class="ttdoc">Simulataion monitoring.</div><div class="ttdef"><b>Definition:</b> <a href="frame_8f_source.html#l00058">frame.f:59</a></div></div>
<div class="ttc" id="agroup__frame_html_ga3b2fa5ca96c4d901949ed15b9e1e459c"><div class="ttname"><a href="group__frame.html#ga3b2fa5ca96c4d901949ed15b9e1e459c">frame_start</a></div><div class="ttdeci">subroutine frame_start</div><div class="ttdoc">Start framework.</div><div class="ttdef"><b>Definition:</b> <a href="frame_8f_source.html#l00011">frame.f:12</a></div></div>
<div class="ttc" id="agroup__frame_html_ga81cd9de9df55590aae9e54090dd1a3ce"><div class="ttname"><a href="group__frame.html#ga81cd9de9df55590aae9e54090dd1a3ce">frame_end</a></div><div class="ttdeci">subroutine frame_end</div><div class="ttdoc">Finalise framework.</div><div class="ttdef"><b>Definition:</b> <a href="frame_8f_source.html#l00075">frame.f:76</a></div></div>
<div class="ttc" id="agroup__stat_html_ga16cd0d213c2bea15c7caf8c205241388"><div class="ttname"><a href="group__stat.html#ga16cd0d213c2bea15c7caf8c205241388">stat_avg</a></div><div class="ttdeci">subroutine stat_avg</div><div class="ttdoc">Main interface of statistics module.</div><div class="ttdef"><b>Definition:</b> <a href="stat_8f_source.html#l00236">stat.f:237</a></div></div>
<div class="ttc" id="agroup__stat_html_ga451d6573c47246d8e0c35e4028a3a1f0"><div class="ttname"><a href="group__stat.html#ga451d6573c47246d8e0c35e4028a3a1f0">stat_init</a></div><div class="ttdeci">subroutine stat_init()</div><div class="ttdoc">Initilise statistics module.</div><div class="ttdef"><b>Definition:</b> <a href="stat_8f_source.html#l00110">stat.f:111</a></div></div>
<div class="ttc" id="agroup__stat_html_ga5b0d78dee858f1d9efcd6ce57aeb5ec8"><div class="ttname"><a href="group__stat.html#ga5b0d78dee858f1d9efcd6ce57aeb5ec8">stat_register</a></div><div class="ttdeci">subroutine stat_register()</div><div class="ttdoc">Register 2D and 3D statistics module.</div><div class="ttdef"><b>Definition:</b> <a href="stat_8f_source.html#l00012">stat.f:13</a></div></div>
<div class="ttc" id="agroup__stat_html_gaac93fa6c1a2e5a04333c0023f52b95f8"><div class="ttname"><a href="group__stat.html#gaac93fa6c1a2e5a04333c0023f52b95f8">stat_end</a></div><div class="ttdeci">subroutine stat_end()</div><div class="ttdoc">Finalise statistics module.</div><div class="ttdef"><b>Definition:</b> <a href="stat_8f_source.html#l00185">stat.f:186</a></div></div>
</div><!-- fragment --><p>Each tool has to provide routines for registration, intialisation and finalisation of the given module. <a class="el" href="group__chkpt.html#gab4a17862a5f644ef26e2538240fc3ae8">chkpt_register</a> and <a class="el" href="group__chkpt.html#ga1523ccf52ac13164ba8fcb08a7d0da33">chkpt_init</a> are good example of them.</p>
<p>Dependencies between different modules can be expressed as a tree structure, which we would like to follow in our database. That is why each module during registration has to specify its parent, which can be its real parent module (for submodules) or FRAME module (the first module registered by frame). In a similar way we specify parents for timers.</p>
<p>The list of all defined parameters, their dafault values and dependency between different modules are described in following pages:</p><ul>
<li><a class="el" href="parameter_list_page.html">List of runtime parameters provided by modules.</a></li>
<li><a class="el" href="parameter_required_page.html">List of runtime parameters required by modules.</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 29 2023 10:19:33 for KTH framework for Nek5000 toolboxes; testing version by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
