<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KTH framework for Nek5000 toolboxes; testing version: Tool development workflow.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KTH framework for Nek5000 toolboxes; testing version
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('developmnet_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tool development workflow. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>External users can contribute to the framework in multiple ways including bug reporting and new tool implementation. As KTH_Toolbox} and KTH_Examples are public repositories, it can be easily done using GitHub pull requests. There are a few requirements each tool has to fulfil to be added to the repository. Each tool has to be written in Fortran77, has to be consistent with the framework modular structure and in an optimal way reuse existing modules to avoid code duplication. The bigger tools that perform multiple operations should be split into smaller ones, if standalone utilities could be extracted. It is important that the developers are familiar with <a class="el" href="group__frame.html">frame</a> module, as all the registering, timing and logging operations should be performed with interfaces provided by this module and its sub-modules.</p>
<p>Building the new module starts with defining the tasks, splitting the code into possible sub-modules and placing them in KTH_Toolbox directory tree structure. After the new directories are created, the <em>toolbox_path.sh</em> script located in the top toolbox directory should be updated and the new modules' paths should be added. For each of the tools, dependency with other modules has to be clearly defined by identification of the provided and required interfaces. There are at least three interfaces that have to be present for each module: subroutines providing module registration (<em>###_register</em>) and initialisation (<em>###_init</em>), and a function returning the initialisation status (<em>###_is_initialised</em>). A subroutine preforming module finalisation (<em>###_end</em>) is optional. A common practise is to also define a <em>###_main</em> subroutine that could be called in <em>userchk</em> and would perform all the tool's operations. We follow here a naming convention, where all module's routine and global variable names start with a module acronym marked in this section as <em>###</em>. This acronym is used as well by the framework logging system and allows to distinguish different modules' messages. It is worth mentioning that there are exceptions and not all the modules contain registration and initialisation subroutines. Good examples are the <a class="el" href="group__comm.html">Comunication routines.</a> and <a class="el" href="group__math.html">Math</a> modules containing a set of useful routines, but not performing any specific tasks. These modules do not provide any run-time parameters or timers, so there is no need to add them to <a class="el" href="group__frame.html">Frame module</a> databases.</p>
<p>A registration means adding to the framework databases a module itself together with all the required timers, the run-time parameters and a run-time parameter section, and receiving a unique identification number for each of the registered objects. Both modules and timers are registered in a tree-like structure and have to provide their parent id. It simplifies writing a summary to the log file and allows to exhibit dependencies between modules. That is why registration starts with finding the parent id for both the module and the timer. In the case of the run-time parameters, a default value has to be provided during the registration step.</p>
<p>On the other hand, the module initialisation starts with an update of the run-time parameter values followed by the tool-specific actions. The last step is marking the initialisation to be completed by setting a module initialisation flag. The registration process requires a number of global variables to be defined, as each of the identification numbers has to be stored. Unfortunately, Fortran77 does not provide variable encapsulation, so all these variables have to be defined in common blocks. To make them available to other modules, the common blocks have to be declared in a separate Fortran77 include-file.</p>
<p>The module's code has to be self-contained, so that together with the used sub-modules it provides all the required operations including e.g., writing and reading tool-specific restart files. If the source code is present in the module, a template of compilation rules <em>makefile_usr.inc</em> has to be added. It has to use paths defined in <em>toolbox_path.sh</em>. When the user interface or the run-time parameter is defined, the corresponding templates of <em>example.usr</em> or <em>example.par</em> have to be present as well. Next, the general module documentation in <em>FRAMEWORK.txt</em> has to be generated. It should contain adequate sections mentioned in <a class="el" href="group__toolbox.html">Toolbox page</a> and clearly state module dependencies. The last step is the generation of a small example and adding it to KTH_Examples repository. Existing modules and examples provide the best guidelines for building new tools. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 29 2023 10:19:33 for KTH framework for Nek5000 toolboxes; testing version by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
